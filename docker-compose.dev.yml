services:
  meilisearch:
    image: getmeili/meilisearch:latest
    container_name: loggator-meilisearch-dev
    ports:
      - '7700:7700'
    environment:
      - MEILI_NO_ANALYTICS=true
      - MEILI_MASTER_KEY=${MEILISEARCH_MASTER_KEY:-bLwLpwgIW6VQTBrt7ZhUw9MiJXYh8Vat7YVr4lU-5XA}
    volumes:
      - ./meilisearch-data:/meili_data
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:7700/health']
      interval: 10s
      timeout: 5s
      retries: 5
    restart: unless-stopped

  apprise:
    image: caronc/apprise:latest
    container_name: loggator-apprise-dev
    ports:
      - '8000:8000'
    environment:
      - APPRISE_STATELESS_URLS=Yes
    volumes:
      - ./apprise-data:/config
    healthcheck:
      test: ['CMD-SHELL', 'curl -f http://localhost:8000/ || exit 1']
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 10s
    restart: unless-stopped

  test-logger:
    image: alpine:latest
    container_name: loggator-test-logger-dev
    labels:
      - 'loggator.enable=true'
    command: >
      sh -c "while true; do
        echo '[INFO] Application started';
        sleep 2;
        echo '[DEBUG] Processing task';
        sleep 3;
        echo '[WARN] Memory usage high';
        sleep 2;
        echo '[ERROR] Connection timeout';
        sleep 4;
      done"
